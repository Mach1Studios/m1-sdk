!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).OSC=t()}(this,function(){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function e(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function c(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?t(Object(i),!0).forEach(function(e){var t,n,r;t=o,r=i[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function f(e){return Number(e)===e&&e%1==0}function h(e){return Number(e)===e&&e%1!=0}function l(e){return"string"==typeof e}function d(e){return"[object Array]"===Object.prototype.toString.call(e)}function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(e){return"function"==typeof e}function w(e){return e instanceof Uint8Array}function y(e){return void 0===e}function g(e){return e+3&-4}function k(e){return Object.prototype.hasOwnProperty.call("undefined"!=typeof global?global:window,e)}function b(e){if(f(e))return"i";if(h(e))return"f";if(l(e))return"s";if(w(e))return"b";throw new Error("OSC typeTag() found unknown value type")}function m(e){var t="";if(d(e))return"/".concat(e.join("/"));if(l(e))return 1<(t=e).length&&"/"===t[t.length-1]&&(t=t.slice(0,t.length-1)),1<t.length&&"/"!==t[0]&&(t="/".concat(t)),t;throw new Error("OSC prepareAddress() needs addresses of type array or string")}function S(e){if(!l(e))throw new Error("OSC prepareRegExPattern() needs strings");return e.replace(/\./g,"\\.").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\{/g,"(").replace(/\}/g,")").replace(/,/g,"|").replace(/\[!/g,"[^").replace(/\?/g,".").replace(/\*/g,".*")}var O=(e(E,[{key:"add",value:function(e){var t=e.pack();return this.byteLength+=t.byteLength,this.data.push(t),this}},{key:"merge",value:function(){var t=new Uint8Array(this.byteLength),n=0;return this.data.forEach(function(e){t.set(e,n),n+=e.byteLength}),t}}]),E);function E(){o(this,E),this.data=[],this.byteLength=0}var C=(e(P,[{key:"pack",value:function(e,t){if(!e||!t)throw new Error("OSC Atomic cant't be packed without given method or byteLength");var n=new Uint8Array(t),r=new DataView(n.buffer);if(y(this.value))throw new Error("OSC Atomic cant't be encoded with empty value");return r[e](this.offset,this.value,!1),n}},{key:"unpack",value:function(e,t,n,r){var o=3<arguments.length&&void 0!==r?r:0;if(!(e&&t&&n))throw new Error("OSC Atomic cant't be unpacked without given dataView, method or byteLength");if(!(e instanceof DataView))throw new Error("OSC Atomic expects an instance of type DataView");return this.value=e[t](o,!1),this.offset=o+n,this.offset}}]),P);function P(e){o(this,P),this.value=e,this.offset=0}var A=(n(D,C),e(D,[{key:"pack",value:function(){return u(i(D.prototype),"pack",this).call(this,"setInt32",4)}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;return u(i(D.prototype),"unpack",this).call(this,e,"getInt32",4,n)}}]),D);function D(e){if(o(this,D),e&&!f(e))throw new Error("OSC AtomicInt32 constructor expects value of type number");return a(this,i(D).call(this,e))}var j="utf-8";var x=(n(H,C),e(H,[{key:"pack",value:function(){if(y(this.value))throw new Error("OSC AtomicString can not be encoded with empty value");for(var e="".concat(this.value,"\0"),t=g(e.length),n=new Uint8Array(t),r=0;r<e.length;r+=1)n[r]=e.charCodeAt(r);return n}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC AtomicString expects an instance of type DataView");for(var r,o=n,i=[];o<e.byteLength;o+=1){if(0===(r=e.getUint8(o))){o+=1;break}i.push(r)}if(o===e.length)throw new Error("OSC AtomicString found a malformed OSC string");return this.offset=g(o),this.value=function(e){if(k("Buffer"))return Buffer.from(e).toString(j);if(k("TextDecoder"))return new TextDecoder(j).decode(new Int8Array(e));for(var t="",n=0;n<e.length;n+=65537)t+=String.fromCharCode.apply(null,e.slice(n,n+65537));return t}(i),this.offset}}]),H);function H(e){if(o(this,H),e&&!l(e))throw new Error("OSC AtomicString constructor expects value of type string");return a(this,i(H).call(this,e))}var I=2208988800,L=4294967296,_=(e(B,[{key:"timestamp",value:function(e){var t;if("number"!=typeof e)return 1e3*((t=this.seconds-I)+Math.round(this.fractions/L));t=e/1e3;var n=Math.floor(t);return this.seconds=n+I,this.fractions=Math.round(L*(t-n)),e}}]),B);function B(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(o(this,B),!f(e)||!f(t))throw new Error("OSC Timetag constructor expects values of type integer number");this.seconds=e,this.fractions=t}var V=(n(M,C),e(M,[{key:"pack",value:function(){if(y(this.value))throw new Error("OSC AtomicTimetag can not be encoded with empty value");var e=this.value,t=e.seconds,n=e.fractions,r=new Uint8Array(8),o=new DataView(r.buffer);return o.setInt32(0,t,!1),o.setInt32(4,n,!1),r}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC AtomicTimetag expects an instance of type DataView");var r=e.getUint32(n,!1),o=e.getUint32(n+4,!1);return this.value=new _(r,o),this.offset=n+8,this.offset}}]),M);function M(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Date.now();o(this,M);var t=new _;return e instanceof _?t=e:f(e)?t.timestamp(e):function(e){return e instanceof Date}(e)&&t.timestamp(e.getTime()),a(this,i(M).call(this,t))}var T=(n(N,C),e(N,[{key:"pack",value:function(){if(y(this.value))throw new Error("OSC AtomicBlob can not be encoded with empty value");var e=g(this.value.byteLength),t=new Uint8Array(e+4);return new DataView(t.buffer).setInt32(0,this.value.byteLength,!1),t.set(this.value,4),t}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC AtomicBlob expects an instance of type DataView");var r=e.getInt32(n,!1);return this.value=new Uint8Array(e.buffer,n+4,r),this.offset=g(n+4+r),this.offset}}]),N);function N(e){if(o(this,N),e&&!w(e))throw new Error("OSC AtomicBlob constructor expects value of type Uint8Array");return a(this,i(N).call(this,e))}var U=(n(R,C),e(R,[{key:"pack",value:function(){return u(i(R.prototype),"pack",this).call(this,"setFloat32",4)}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;return u(i(R.prototype),"unpack",this).call(this,e,"getFloat32",4,n)}}]),R);function R(e){if(o(this,R),e&&!h(e))throw new Error("OSC AtomicFloat32 constructor expects value of type float");return a(this,i(R).call(this,e))}var W=(e(q,[{key:"add",value:function(e){if(y(e))throw new Error("OSC Message needs a valid OSC Atomic Data Type");this.args.push(e),this.types+=b(e)}},{key:"pack",value:function(){if(0===this.address.length||"/"!==this.address[0])throw new Error("OSC Message has an invalid address");var t,n=new O;return n.add(new x(this.address)),n.add(new x(",".concat(this.types))),0<this.args.length&&this.args.forEach(function(e){if(f(e))t=new A(e);else if(h(e))t=new U(e);else if(l(e))t=new x(e);else{if(!w(e))throw new Error("OSC Message found unknown argument type");t=new T(e)}n.add(t)}),n.merge()}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC Message expects an instance of type DataView.");var r=new x;r.unpack(e,n);var o=new x;if(o.unpack(e,r.offset),0===r.value.length||"/"!==r.value[0])throw new Error("OSC Message found malformed or missing address string");if(0===o.value.length&&","!==o.value[0])throw new Error("OSC Message found malformed or missing type string");for(var i,s,a=o.offset,u=[],c=1;c<o.value.length;c+=1){if("i"===(s=o.value[c]))i=new A;else if("f"===s)i=new U;else if("s"===s)i=new x;else{if("b"!==s)throw new Error("OSC Message found non-standard argument type");i=new T}a=i.unpack(e,a),u.push(i.value)}return this.offset=a,this.address=r.value,this.types=o.value,this.args=u,this.offset}}]),q);function q(){o(this,q),this.offset=0,this.address="",this.types="",this.args=[];for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0<t.length){if(!l(t[0])&&!d(t[0]))throw new Error("OSC Message constructor first argument (address) must be a string or array");this.address=m(t.shift()),this.types=t.map(function(e){return b(e)}).join(""),this.args=t}}var F="#bundle",z=(e(G,[{key:"timestamp",value:function(e){if(!f(e))throw new Error("OSC Bundle needs an integer for setting the timestamp");this.timetag=new V(e)}},{key:"add",value:function(e){if(!(e instanceof W||e instanceof G))throw new Error("OSC Bundle contains only Messages and Bundles");this.bundleElements.push(e)}},{key:"pack",value:function(){var t=new O;return t.add(new x(F)),this.timetag||(this.timetag=new V),t.add(this.timetag),this.bundleElements.forEach(function(e){t.add(new A(e.pack().byteLength)),t.add(e)}),t.merge()}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC Bundle expects an instance of type DataView");var r=new x;if(r.unpack(e,n),r.value!==F)throw new Error("OSC Bundle does not contain a valid #bundle head");var o=new V,i=o.unpack(e,r.offset);for(this.bundleElements=[];i<e.byteLength;){var s=new x;i=(new A).unpack(e,i);var a=void 0;s.unpack(e,i),i=(a=s.value===F?new G:new W).unpack(e,i),this.bundleElements.push(a)}return this.offset=i,this.timetag=o,this.offset}}]),G);function G(){var t=this;o(this,G),this.offset=0,this.timetag=new V,this.bundleElements=[];for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];0<n.length&&(n[0]instanceof Date||f(n[0])?this.timetag=new V(n[0]):d(n[0])?(n[0].forEach(function(e){t.add(e)}),1<n.length&&(n[1]instanceof Date||f(n[0]))&&(this.timetag=new V(n[1]))):n.forEach(function(e){t.add(e)}))}var Z=(e(J,[{key:"pack",value:function(){if(!this.value)throw new Error("OSC Packet can not be encoded with empty body");return this.value.pack()}},{key:"unpack",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:0;if(!(e instanceof DataView))throw new Error("OSC Packet expects an instance of type DataView");if(e.byteLength%4!=0)throw new Error("OSC Packet byteLength has to be a multiple of four");var r,o=new x;return o.unpack(e,n),(r=o.value===F?new z:new W).unpack(e,n),this.offset=r.offset,this.value=r,this.offset}}]),J);function J(e){if(o(this,J),e&&!(e instanceof W||e instanceof z))throw new Error("OSC Packet value has to be Message or Bundle");this.value=e,this.offset=0}var K={discardLateMessages:!1},Q=(e(X,[{key:"dispatch",value:function(e,n){var r=this;if(!(e instanceof Z))throw new Error("OSC EventHander dispatch() accepts only arguments of type Packet");if(!e.value)throw new Error("OSC EventHander dispatch() can't read empty Packets");if(e.value instanceof z){var o=e.value;return o.bundleElements.forEach(function(e){if(e instanceof z){if(o.timetag.value.timestamp()<e.timetag.value.timestamp())throw new Error("OSC Bundle timestamp is older than the timestamp of enclosed Bundles");return r.dispatch(e)}if(e instanceof W){var t=e;return r.notify(t.address,t,o.timetag.value.timestamp(),n)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")})}if(e.value instanceof W){var t=e.value;return this.notify(t.address,t,0,n)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}},{key:"call",value:function(o,i,s){var a=!1;if(l(o)&&o in this.eventHandlers)return this.eventHandlers[o].forEach(function(e){e.callback(i,s),a=!0}),a;var e=Object.keys(this.addressHandlers),u=this.addressHandlers;return e.forEach(function(e){var t=!1,n=new RegExp(S(m(o)),"g");if(n.test(e)&&e.length===n.lastIndex&&(t=!0),!t){var r=new RegExp(S(m(e)),"g");r.test(o)&&o.length===r.lastIndex&&(t=!0)}t&&u[e].forEach(function(e){e.callback(i,s),a=!0})}),a}},{key:"notify",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)throw new Error("OSC EventHandler can not be called without any argument");if(t[0]instanceof Z)return this.dispatch(t[0],t[1]);if(t[0]instanceof z||t[0]instanceof W)return this.dispatch(new Z(t[0]),t[1]);if(!l(t[0])){var r=new Z;return r.unpack(function(e){return e.buffer?new DataView(e.buffer):e instanceof ArrayBuffer?new DataView(e):new DataView(new Uint8Array(e))}(t[0])),this.dispatch(r,t[1])}var o=t[0],i=null;1<t.length&&(i=t[1]);var s=null;if(2<t.length)if(f(t[2]))s=t[2];else{if(!(t[2]instanceof Date))throw new Error("OSC EventHandler timestamp has to be a number or Date");s=t[2].getTime()}var a=null;if(3<=t.length&&(a=t[3]),s){var u=Date.now();if(s<u&&!this.options.discardLateMessages)return this.call(o,i,a);var c=this;return setTimeout(function(){c.call(o,i,a)},s-u),!0}return this.call(o,i,a)}},{key:"on",value:function(e,t){if(!l(e)&&!d(e))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!v(t))throw new Error("OSC EventHandler callback has to be a function");this.uuid+=1;var n={id:this.uuid,callback:t};if(l(e)&&e in this.eventHandlers)return this.eventHandlers[e].push(n),this.uuid;var r=m(e);return r in this.addressHandlers||(this.addressHandlers[r]=[]),this.addressHandlers[r].push(n),this.uuid}},{key:"off",value:function(e,n){if(!l(e)&&!d(e))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!f(n))throw new Error("OSC EventHandler subscription id has to be a number");var r,o;return o=l(e)&&e in this.eventHandlers?(r=e,this.eventHandlers):(r=m(e),this.addressHandlers),r in o&&o[r].some(function(e,t){return e.id===n&&(o[r].splice(t,1),!0)})}}]),X);function X(e){o(this,X),this.options=c({},K,{},e),this.addressHandlers=[],this.eventHandlers={open:[],error:[],close:[]},this.uuid=0}var Y="undefined"!=typeof __dirname?require("dgram"):void 0,$=-1,ee=0,te=1,ne=2,re=3,oe={type:"udp4",open:{host:"localhost",port:41234,exclusive:!1},send:{host:"localhost",port:41235}};var ie=(e(se,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(e){var t=this,n=0<arguments.length&&void 0!==e?e:{},r=c({},this.options.open,{},n),o=r.port,i=r.exclusive;this.socketStatus=ee,this.socket.bind({address:r.host,port:o,exclusive:i},function(){t.socketStatus=te,t.notify("open")})}},{key:"close",value:function(){var e=this;this.socketStatus=ne,this.socket.close(function(){e.socketStatus=re,e.notify("close")})}},{key:"send",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=c({},this.options.send,{},n),o=r.port,i=r.host;this.socket.send(Buffer.from(e),0,e.byteLength,o,i)}}]),se);function se(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(o(this,se),!Y)throw new Error("DatagramPlugin can not be used in browser context");this.options=function(e,t){return c({},oe,{},e,{},t,{open:c({},oe.open,{},e.open,{},t.open),send:c({},oe.send,{},e.send,{},t.send)})}({},e),this.socket=Y.createSocket(this.options.type),this.socketStatus=$,this.socket.on("message",function(e,t){n.notify(e,t)}),this.socket.on("error",function(e){n.notify("error",e)}),this.notify=function(){}}var ae="undefined"!=typeof __dirname?require("dgram"):void 0,ue="undefined"!=typeof __dirname?require("isomorphic-ws").Server:void 0,ce=-1,fe=0,he=1,le=2,de=3,pe={udpServer:{host:"localhost",port:41234,exclusive:!1},udpClient:{host:"localhost",port:41235},wsServer:{host:"localhost",port:8080},receiver:"ws"};function ve(e,t){return c({},pe,{},e,{},t,{udpServer:c({},pe.udpServer,{},e.udpServer,{},t.udpServer),udpClient:c({},pe.udpClient,{},e.udpClient,{},t.udpClient),wsServer:c({},pe.wsServer,{},e.wsServer,{},t.wsServer)})}var we=(e(ye,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(e){var n=this,t=0<arguments.length&&void 0!==e?e:{},r=ve(this.options,t);this.socketStatus=fe,this.socket.bind({address:r.udpServer.host,port:r.udpServer.port,exclusive:r.udpServer.exclusive},function(){n.websocket=new ue({host:r.wsServer.host,port:r.wsServer.port}),n.websocket.binaryType="arraybuffer",n.websocket.on("listening",function(){n.socketStatus=he,n.notify("open")}),n.websocket.on("error",function(e){n.notify("error",e)}),n.websocket.on("connection",function(e){e.on("message",function(e,t){n.send(e,{receiver:"udp"}),n.notify(new Uint8Array(e),t)})})})}},{key:"close",value:function(){var e=this;this.socketStatus=le,this.socket.close(function(){e.websocket.close(function(){e.socketStatus=de,e.notify("close")})})}},{key:"send",value:function(t,e){var n=1<arguments.length&&void 0!==e?e:{},r=ve(this.options,n),o=r.receiver;if("udp"===o){var i=t instanceof Buffer?t:Buffer.from(t);this.socket.send(i,0,i.byteLength,r.udpClient.port,r.udpClient.host)}else{if("ws"!==o)throw new Error("BridgePlugin can not send message to unknown receiver");this.websocket.clients.forEach(function(e){e.send(t,{binary:!0})})}}}]),ye);function ye(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(o(this,ye),!ae||!ue)throw new Error("BridgePlugin can not be used in browser context");this.options=ve({},e),this.websocket=null,this.socket=ae.createSocket("udp4"),this.socketStatus=ce,this.socket.on("message",function(e){t.send(e,{receiver:"ws"}),t.notify(e.buffer)}),this.socket.on("error",function(e){t.notify("error",e)}),this.notify=function(){}}var ge="undefined"==typeof global?window:global,ke="undefined"==typeof __dirname?ge.WebSocket:require("isomorphic-ws"),be=-1,me=0,Se=1,Oe=2,Ee=3,Ce={host:"localhost",port:8080,secure:!1},Pe=(e(Ae,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(e){var t=this,n=0<arguments.length&&void 0!==e?e:{},r=c({},this.options,{},n),o=r.port,i=r.host,s=r.secure;this.socket&&this.close();var a=s?"wss":"ws",u={address:i,family:a,port:o,size:0};this.socket=new ke("".concat(a,"://").concat(i,":").concat(o)),this.socket.binaryType="arraybuffer",this.socketStatus=me,this.socket.onopen=function(){t.socketStatus=Se,t.notify("open")},this.socket.onclose=function(){t.socketStatus=Ee,t.notify("close")},this.socket.onerror=function(e){t.notify("error",e)},this.socket.onmessage=function(e){t.notify(e.data,u)}}},{key:"close",value:function(){this.socketStatus=Oe,this.socket.close()}},{key:"send",value:function(e){this.socket.send(e)}}]),Ae);function Ae(e){if(o(this,Ae),!ke)throw new Error("WebsocketClientPlugin can't find a WebSocket class");this.options=c({},Ce,{},e),this.socket=null,this.socketStatus=be,this.notify=function(){}}var De="undefined"!=typeof __dirname?require("isomorphic-ws").Server:void 0,je=-1,xe=0,He=1,Ie=2,Le=3,_e={host:"localhost",port:8080},Be=(e(Ve,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(e){var t=this,n=0<arguments.length&&void 0!==e?e:{},r=c({},this.options,{},n),o=r.port,i=r.host,s={address:i,family:"wsserver",port:o,size:0};this.socket&&this.close(),this.socket=new De({host:i,port:o}),this.socket.binaryType="arraybuffer",this.socketStatus=xe,this.socket.on("listening",function(){t.socketStatus=He,t.notify("open")}),this.socket.on("error",function(e){t.notify("error",e)}),this.socket.on("connection",function(e){e.on("message",function(e){t.notify(new Uint8Array(e),s)})})}},{key:"close",value:function(){var e=this;this.socketStatus=Ie,this.socket.close(function(){e.socketStatus=Le,e.notify("close")})}},{key:"send",value:function(t){this.socket.clients.forEach(function(e){e.send(t,{binary:!0})})}}]),Ve);function Ve(e){if(o(this,Ve),!De)throw new Error("WebsocketServerPlugin can not be used in browser context");this.options=c({},_e,{},e),this.socket=null,this.socketStatus=je,this.notify=function(){}}var Me={discardLateMessages:!1,plugin:new Pe},Te=(e(Ne,[{key:"on",value:function(e,t){if(!l(e)||!v(t))throw new Error("OSC on() needs event- or address string and callback function");return this.eventHandler.on(e,t)}},{key:"off",value:function(e,t){if(!l(e)||!f(t))throw new Error("OSC off() needs string and number (subscriptionId) to unsubscribe");return this.eventHandler.off(e,t)}},{key:"open",value:function(e){if(e&&!p(e))throw new Error("OSC open() options argument needs to be an object");if(!this.options.plugin||!v(this.options.plugin.open))throw new Error("OSC Plugin API #open is not implemented!");return this.options.plugin.open(e)}},{key:"status",value:function(){if(!this.options.plugin||!v(this.options.plugin.status))throw new Error("OSC Plugin API #status is not implemented!");return this.options.plugin.status()}},{key:"close",value:function(){if(!this.options.plugin||!v(this.options.plugin.close))throw new Error("OSC Plugin API #close is not implemented!");return this.options.plugin.close()}},{key:"send",value:function(e,t){if(!this.options.plugin||!v(this.options.plugin.send))throw new Error("OSC Plugin API #send is not implemented!");if(!(e instanceof W||e instanceof z||e instanceof Z))throw new Error("OSC send() needs Messages, Bundles or Packets");if(t&&!p(t))throw new Error("OSC send() options argument has to be an object");return this.options.plugin.send(e.pack(),t)}}]),Ne);function Ne(e){if(o(this,Ne),e&&!p(e))throw new Error("OSC options argument has to be an object.");this.options=c({},Me,{},e),this.eventHandler=new Q({discardLateMessages:this.options.discardLateMessages});var t=this.eventHandler;this.options.plugin&&this.options.plugin.registerNotify&&this.options.plugin.registerNotify(function(){return t.notify.apply(t,arguments)})}return Te.STATUS={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},Te.Packet=Z,Te.Bundle=z,Te.Message=W,Te.DatagramPlugin=ie,Te.WebsocketClientPlugin=Pe,Te.WebsocketServerPlugin=Be,Te.BridgePlugin=we,Te});
//# sourceMappingURL=osc.min.js.map
